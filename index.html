async function downloadTreatmentPlanPDF() {
  const { jsPDF } = window.jspdf;
  const treatmentPlanElement = document.getElementById('treatmentPlan');

  try {
    // Utilisation de html2canvas pour capturer le contenu HTML
    const canvas = await html2canvas(treatmentPlanElement, { scale: 2 });
    const imgData = canvas.toDataURL('image/png');

    const pdf = new jsPDF('p', 'mm', 'a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();

    // Ajout de l'en-tête avec le logo, le titre et la date
    const imgLogo = new Image();
    imgLogo.src = 'logo.png';
    imgLogo.crossOrigin = 'anonymous';
    await new Promise((resolve, reject) => {
      imgLogo.onload = resolve;
      imgLogo.onerror = () => reject("Erreur lors du chargement du logo.");
    });

    const logoWidth = 30;
    const logoHeight = 30;
    pdf.addImage(imgLogo, 'PNG', 10, 10, logoWidth, logoHeight);
    pdf.setFontSize(16);
    pdf.setFont('helvetica', 'bold');
    pdf.text("Plan de Traitement Personnalisé", 50, 20);
    pdf.setFontSize(12);
    const currentDate = new Date().toLocaleDateString('fr-FR');
    pdf.text(`Date de génération: ${currentDate}`, pdfWidth - 60, 20);

    // Bandeau bleu clair sous l'en-tête
    pdf.setFillColor('#E8F4FB');
    pdf.rect(10, 25, pdfWidth - 20, 5, 'F');

    // Calcul de la hauteur de l'image capturée
    const imgProps = pdf.getImageProperties(imgData);
    const imgWidth = pdfWidth - 20;
    const imgHeight = (imgProps.height * imgWidth) / imgProps.width;

    // Ajout du contenu capturé
    pdf.addImage(imgData, 'PNG', 10, 30, imgWidth, imgHeight);

    // Sauvegarde du PDF
    pdf.save("Plan_de_Traitement.pdf");
    showConfirmation("Plan de traitement téléchargé avec succès");
  } catch (error) {
    console.error("Erreur lors de la génération du PDF :", error);
    showConfirmation("Erreur lors du téléchargement du plan de traitement.");
  }
}
